/**
 * Japanese national holidays (祝日) data and utility functions.
 *
 * Covers 2024-2027 based on 内閣府告示.
 * Includes 振替休日 (substitute holidays) when a holiday falls on Sunday.
 */

/** Map of 'YYYY-MM-DD' to holiday name */
export const JAPANESE_HOLIDAYS: Map<string, string> = new Map([
  // ── 2024 ──────────────────────────────────────────
  ['2024-01-01', '元日'],
  ['2024-01-08', '成人の日'],
  ['2024-02-11', '建国記念の日'],
  ['2024-02-12', '振替休日'], // 建国記念の日 振替
  ['2024-02-23', '天皇誕生日'],
  ['2024-03-20', '春分の日'],
  ['2024-04-29', '昭和の日'],
  ['2024-05-03', '憲法記念日'],
  ['2024-05-04', 'みどりの日'],
  ['2024-05-05', 'こどもの日'],
  ['2024-05-06', '振替休日'], // こどもの日 振替
  ['2024-07-15', '海の日'],
  ['2024-08-11', '山の日'],
  ['2024-08-12', '振替休日'], // 山の日 振替
  ['2024-09-16', '敬老の日'],
  ['2024-09-22', '秋分の日'],
  ['2024-09-23', '振替休日'], // 秋分の日 振替
  ['2024-10-14', 'スポーツの日'],
  ['2024-11-03', '文化の日'],
  ['2024-11-04', '振替休日'], // 文化の日 振替
  ['2024-11-23', '勤労感謝の日'],

  // ── 2025 ──────────────────────────────────────────
  ['2025-01-01', '元日'],
  ['2025-01-13', '成人の日'],
  ['2025-02-11', '建国記念の日'],
  ['2025-02-23', '天皇誕生日'],
  ['2025-02-24', '振替休日'], // 天皇誕生日 振替
  ['2025-03-20', '春分の日'],
  ['2025-04-29', '昭和の日'],
  ['2025-05-03', '憲法記念日'],
  ['2025-05-04', 'みどりの日'],
  ['2025-05-05', 'こどもの日'],
  ['2025-05-06', '振替休日'], // みどりの日 振替
  ['2025-07-21', '海の日'],
  ['2025-08-11', '山の日'],
  ['2025-09-15', '敬老の日'],
  ['2025-09-23', '秋分の日'],
  ['2025-10-13', 'スポーツの日'],
  ['2025-11-03', '文化の日'],
  ['2025-11-23', '勤労感謝の日'],
  ['2025-11-24', '振替休日'], // 勤労感謝の日 振替

  // ── 2026 ──────────────────────────────────────────
  ['2026-01-01', '元日'],
  ['2026-01-12', '成人の日'],
  ['2026-02-11', '建国記念の日'],
  ['2026-02-23', '天皇誕生日'],
  ['2026-03-20', '春分の日'],
  ['2026-04-29', '昭和の日'],
  ['2026-05-03', '憲法記念日'],
  ['2026-05-04', 'みどりの日'],
  ['2026-05-05', 'こどもの日'],
  ['2026-05-06', '振替休日'], // こどもの日 振替
  ['2026-07-20', '海の日'],
  ['2026-08-11', '山の日'],
  ['2026-09-21', '敬老の日'],
  ['2026-09-23', '秋分の日'],
  ['2026-10-12', 'スポーツの日'],
  ['2026-11-03', '文化の日'],
  ['2026-11-23', '勤労感謝の日'],

  // ── 2027 ──────────────────────────────────────────
  ['2027-01-01', '元日'],
  ['2027-01-11', '成人の日'],
  ['2027-02-11', '建国記念の日'],
  ['2027-02-23', '天皇誕生日'],
  ['2027-03-21', '春分の日'],
  ['2027-03-22', '振替休日'], // 春分の日 振替
  ['2027-04-29', '昭和の日'],
  ['2027-05-03', '憲法記念日'],
  ['2027-05-04', 'みどりの日'],
  ['2027-05-05', 'こどもの日'],
  ['2027-07-19', '海の日'],
  ['2027-08-11', '山の日'],
  ['2027-09-20', '敬老の日'],
  ['2027-09-23', '秋分の日'],
  ['2027-10-11', 'スポーツの日'],
  ['2027-11-03', '文化の日'],
  ['2027-11-23', '勤労感謝の日'],
]);

/**
 * Format a Date to 'YYYY-MM-DD' in local time.
 */
const formatDateKey = (date: Date): string => {
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, '0');
  const d = String(date.getDate()).padStart(2, '0');
  return `${y}-${m}-${d}`;
};

/**
 * Returns the holiday name if the given date is a Japanese holiday, or null.
 */
export const isHoliday = (date: Date): string | null => {
  return JAPANESE_HOLIDAYS.get(formatDateKey(date)) ?? null;
};

/**
 * Returns all holidays in a given month (1-indexed).
 */
export const getHolidaysForMonth = (
  year: number,
  month: number,
): { date: Date; name: string }[] => {
  const prefix = `${year}-${String(month).padStart(2, '0')}`;
  const results: { date: Date; name: string }[] = [];

  for (const [key, name] of JAPANESE_HOLIDAYS) {
    if (key.startsWith(prefix)) {
      const [y, m, d] = key.split('-').map(Number) as [number, number, number];
      results.push({ date: new Date(y, m - 1, d), name });
    }
  }

  return results.sort((a, b) => a.date.getTime() - b.date.getTime());
};
